{"ast":null,"code":"import _slicedToArray from \"/Users/aaronchu/Development/stock-portfolio-app/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/aaronchu/Development/stock-portfolio-app/frontend/src/containers/Portfolio.js\";\nimport React, { useState, useEffect } from 'react';\nimport BuyStockForm from '../forms/BuyStockForm';\nimport StocksContainer from './StocksContainer';\n\nconst Portfolio = props => {\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        stocks = _useState2[0],\n        setStocks = _useState2[1];\n\n  useEffect(() => {\n    if (props.userData) {\n      // API request from nested endpoint user/:id/transactions\n      fetch(\"http://localhost:3000/users/\".concat(props.userData.id, \"/transactions\")).then(resp => resp.json()).then(userTransactions => {\n        let finalAssortedTransactionsArray = []; // count number of shares for each stock\n\n        let sortedTransactions = {};\n        userTransactions.data.forEach(transaction => {\n          if (sortedTransactions[transaction.attributes.stock.ticker]) {\n            sortedTransactions[transaction.attributes.stock.ticker] += transaction.attributes.quantity;\n          } else {\n            sortedTransactions[transaction.attributes.stock.ticker] = transaction.attributes.quantity;\n          }\n        }); // convert the sorted hash to individual objects in array\n\n        Object.keys(sortedTransactions).forEach(key => {\n          let stockToPush = {};\n          stockToPush[key] = sortedTransactions[key];\n          finalAssortedTransactionsArray = [...finalAssortedTransactionsArray, stockToPush];\n        });\n        setStocks(finalAssortedTransactionsArray);\n      });\n    }\n  }, [props.userData]);\n\n  const handleStockFormSubmit = (ticker, quantity, method) => {\n    fetch(\"https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=\".concat(ticker, \"&apikey=GJNL5RPAWAUNFOK6\")).then(resp => resp.json()).then(stockData => {\n      let userBalance = props.userData.attributes.balance;\n      let price = parseFloat(stockData[\"Global Quote\"][\"05. price\"]);\n      let transactionTotal = price * quantity;\n\n      if (userBalance < transactionTotal) {\n        alert(\"Balance insufficient. Transaction total is \".concat(transactionTotal, \".\"));\n      } else {\n        handleStock(ticker, quantity, price, transactionTotal, method);\n      }\n    }).catch(error => {\n      console.log(error);\n      alert('Oops, something went wrong! Check that you have entered a valid symbol');\n    });\n  };\n\n  const handleStock = (ticker, quantity, price, total, method) => {\n    let stockInfo = {\n      ticker: ticker\n    };\n    fetch('http://localhost:3000/stocks', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(stockInfo)\n    }).then(resp => resp.json()).then(stockData => {\n      handleTransaction(stockData.data, price, quantity, total, method);\n    }).catch(error => console.log(error));\n  };\n\n  const handleTransaction = (stockData, price, quantity, total, method) => {\n    let transactionInfo = {\n      quantity: parseInt(quantity),\n      user_id: props.userData.id,\n      stock_id: parseInt(stockData.id),\n      price: price,\n      method: method\n    };\n    fetch('http://localhost:3000/transactions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(transactionInfo)\n    }).then(resp => resp.json()).then(transactionData => {\n      let balance = props.userData.attributes.balance;\n      let remainingBalance = balance - total;\n      props.handleBalanceChange(remainingBalance);\n    }).catch(error => console.log(error));\n  };\n\n  return React.createElement(\"div\", {\n    className: \"portfolio\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }, props.userData ? React.createElement(StocksContainer, {\n    userData: props.userData,\n    stocks: stocks,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  }) : 'Loading...', React.createElement(BuyStockForm, Object.assign({}, props, {\n    handleStockFormSubmit: handleStockFormSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  })));\n};\n\nexport default Portfolio;","map":{"version":3,"sources":["/Users/aaronchu/Development/stock-portfolio-app/frontend/src/containers/Portfolio.js"],"names":["React","useState","useEffect","BuyStockForm","StocksContainer","Portfolio","props","stocks","setStocks","userData","fetch","id","then","resp","json","userTransactions","finalAssortedTransactionsArray","sortedTransactions","data","forEach","transaction","attributes","stock","ticker","quantity","Object","keys","key","stockToPush","handleStockFormSubmit","method","stockData","userBalance","balance","price","parseFloat","transactionTotal","alert","handleStock","catch","error","console","log","total","stockInfo","headers","Authorization","localStorage","token","body","JSON","stringify","handleTransaction","transactionInfo","parseInt","user_id","stock_id","transactionData","remainingBalance","handleBalanceChange"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport BuyStockForm from '../forms/BuyStockForm'\nimport StocksContainer from './StocksContainer'\n\nconst Portfolio = props => {\n\n  const [stocks, setStocks] = useState([])\n\n  useEffect(() => {\n    if (props.userData) {\n      // API request from nested endpoint user/:id/transactions\n      fetch(`http://localhost:3000/users/${props.userData.id}/transactions`)\n        .then(resp => resp.json())\n        .then(userTransactions => {\n          let finalAssortedTransactionsArray = []\n          // count number of shares for each stock\n          let sortedTransactions = {}\n          userTransactions.data.forEach(transaction => {\n            if (sortedTransactions[transaction.attributes.stock.ticker]) {\n              sortedTransactions[transaction.attributes.stock.ticker] += transaction.attributes.quantity\n            } else {\n              sortedTransactions[transaction.attributes.stock.ticker] = transaction.attributes.quantity\n            }\n          })\n          // convert the sorted hash to individual objects in array\n          Object.keys(sortedTransactions).forEach(key => {\n            let stockToPush = {}\n            stockToPush[key] = sortedTransactions[key]\n            finalAssortedTransactionsArray = [...finalAssortedTransactionsArray, stockToPush]\n          })\n          setStocks(finalAssortedTransactionsArray)\n        })\n    }\n  }, [props.userData])\n\n  const handleStockFormSubmit = (ticker, quantity, method) => {\n    fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=GJNL5RPAWAUNFOK6`)\n      .then(resp => resp.json())\n      .then(stockData => {\n        let userBalance = props.userData.attributes.balance\n        let price = parseFloat(stockData[\"Global Quote\"][\"05. price\"])\n        let transactionTotal = price * quantity\n        if (userBalance < transactionTotal) {\n          alert(`Balance insufficient. Transaction total is ${transactionTotal}.`)\n        } else {\n          handleStock(ticker, quantity, price, transactionTotal, method)\n        }\n      })\n      .catch(error => {\n        console.log(error)\n        alert('Oops, something went wrong! Check that you have entered a valid symbol')\n      })\n  }\n\n  const handleStock = (ticker, quantity, price, total, method) => {\n    let stockInfo = { ticker: ticker }\n    fetch('http://localhost:3000/stocks', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(stockInfo)\n    })\n      .then(resp => resp.json())\n      .then(stockData => {\n        handleTransaction(stockData.data, price, quantity, total, method)\n      })\n      .catch(error => console.log(error))\n  }\n\n  const handleTransaction = (stockData, price, quantity, total, method) => {\n    let transactionInfo = {\n      quantity: parseInt(quantity),\n      user_id: props.userData.id,\n      stock_id: parseInt(stockData.id),\n      price: price,\n      method: method\n    }\n    fetch('http://localhost:3000/transactions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(transactionInfo)\n    })\n      .then(resp => resp.json())\n      .then(transactionData => {\n        let balance = props.userData.attributes.balance\n        let remainingBalance = balance - total\n        props.handleBalanceChange(remainingBalance)\n      })\n      .catch(error => console.log(error))\n  }\n\n  return (\n    <div className=\"portfolio\">\n      {props.userData ? <StocksContainer userData={props.userData} stocks={stocks} /> : 'Loading...'}\n      <BuyStockForm {...props} handleStockFormSubmit={handleStockFormSubmit} />\n    </div>\n  )\n}\n\nexport default Portfolio"]},"metadata":{},"sourceType":"module"}