{"ast":null,"code":"import _slicedToArray from \"/Users/aaronchu/Development/stock-portfolio-app/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/aaronchu/Development/stock-portfolio-app/frontend/src/containers/Portfolio.js\";\nimport React, { useState, useEffect } from 'react';\nimport BuyStockForm from '../forms/BuyStockForm';\nimport PortfolioStock from './PortfolioStock';\n\nconst Portfolio = props => {\n  // const [userData, setUserData] = useState('')\n  // const [userBalance, setUserBalance] = useState('')\n  // useEffect(() => {\n  //   if (props.userData !== \"\") {\n  //     setUserData(props.userData)\n  //     setUserBalance(props.userData.attributes.balance)\n  //   } else {\n  //     props.history.push('/signin')\n  //   }\n  // }, [userData])\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        stocks = _useState2[0],\n        setStocks = _useState2[1];\n\n  useEffect(() => {\n    if (props.userData) {\n      fetch(\"http://localhost:3000/users/\".concat(props.userData.id)).then(resp => resp.json()).then(userInfo => {\n        let final = [];\n        let sortedTransactions = {};\n        userInfo.data.attributes.transactions.forEach(transaction => {\n          if (sortedTransactions[transaction.stock_id]) {\n            sortedTransactions[transaction.stock_id] += sortedTransactions[transaction.quantity];\n          } else {\n            sortedTransactions[transaction.stock_id] = transaction.quantity;\n          }\n        });\n        console.log(sortedTransactions);\n        Object.keys(sortedTransactions).forEach(key => {\n          let stockToPush = {};\n          stockToPush.key = sortedTransactions[key];\n          debugger;\n          final.push(stockToPush);\n        });\n        debugger;\n        setStocks([...stocks, sortedTransactions]);\n      });\n    }\n  }, [props.userData]);\n\n  const handleStockFormSubmit = (ticker, quantity) => {\n    fetch(\"https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=\".concat(ticker, \"&apikey=GJNL5RPAWAUNFOK6\")).then(resp => resp.json()).then(stockData => {\n      let userBalance = props.userData.attributes.balance;\n      let price = parseFloat(stockData[\"Global Quote\"][\"05. price\"]);\n      let transactionTotal = price * quantity;\n\n      if (userBalance < transactionTotal) {\n        alert(\"Balance insufficient. Transaction total is \".concat(transactionTotal, \".\"));\n      } else {\n        handleStock(ticker, quantity, price, transactionTotal);\n      }\n    }).catch(error => console.log(error));\n  };\n\n  const handleStock = (ticker, quantity, price, total) => {\n    let stockInfo = {\n      ticker: ticker,\n      price: price\n    };\n    fetch('http://localhost:3000/stocks', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(stockInfo)\n    }).then(resp => resp.json()).then(stockData => {\n      handleTransaction(stockData.data, quantity, total);\n    }).catch(error => console.log(error));\n  };\n\n  const handleTransaction = (stockData, quantity, total) => {\n    let transactionInfo = {\n      quantity: parseInt(quantity),\n      user_id: props.userData.id,\n      stock_id: parseInt(stockData.id)\n    };\n    fetch('http://localhost:3000/transactions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(transactionInfo)\n    }).then(resp => resp.json()).then(transactionData => {\n      console.log(total);\n      let balance = props.userData.attributes.balance;\n      let remainingBalance = balance - total;\n      props.handleBalanceChange(remainingBalance); // setUserData(\n      //   {\n      //     ...userData,\n      //     attributes: {\n      //       ...userData.attributes,\n      //       balance: remainingBalance\n      //     }\n      //   }\n      // )\n    }).catch(error => console.log(error));\n  }; // const handleBalanceChange = (remainingBalance) => {\n  //   fetch(`http://localhost:3000/users/${this.props.userData.id}`, {\n  //     method: 'PATCH',\n  //     headers: {\n  //       'Accept': 'application/json',\n  //       'Content-Type': 'application/json'\n  //     },\n  //     body: JSON.stringify({ balance: remainingBalance })\n  //   })\n  //     .then(resp => resp.json())\n  //     .then(userData => {\n  //       setUserData(userData.data)\n  //     })\n  // }\n\n\n  return React.createElement(\"div\", {\n    className: \"portfolio\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(PortfolioStock, {\n    userData: props.userData,\n    stocks: stocks,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }), React.createElement(BuyStockForm, Object.assign({}, props, {\n    handleStockFormSubmit: handleStockFormSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  })));\n};\n\nexport default Portfolio;","map":{"version":3,"sources":["/Users/aaronchu/Development/stock-portfolio-app/frontend/src/containers/Portfolio.js"],"names":["React","useState","useEffect","BuyStockForm","PortfolioStock","Portfolio","props","stocks","setStocks","userData","fetch","id","then","resp","json","userInfo","final","sortedTransactions","data","attributes","transactions","forEach","transaction","stock_id","quantity","console","log","Object","keys","key","stockToPush","push","handleStockFormSubmit","ticker","stockData","userBalance","balance","price","parseFloat","transactionTotal","alert","handleStock","catch","error","total","stockInfo","method","headers","Authorization","localStorage","token","body","JSON","stringify","handleTransaction","transactionInfo","parseInt","user_id","transactionData","remainingBalance","handleBalanceChange"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport BuyStockForm from '../forms/BuyStockForm'\nimport PortfolioStock from './PortfolioStock'\n\nconst Portfolio = props => {\n\n  // const [userData, setUserData] = useState('')\n  // const [userBalance, setUserBalance] = useState('')\n\n  // useEffect(() => {\n  //   if (props.userData !== \"\") {\n  //     setUserData(props.userData)\n  //     setUserBalance(props.userData.attributes.balance)\n  //   } else {\n  //     props.history.push('/signin')\n  //   }\n  // }, [userData])\n\n  const [stocks, setStocks] = useState([])\n  useEffect(() => {\n    if(props.userData){\n      fetch(`http://localhost:3000/users/${props.userData.id}`)\n      .then(resp => resp.json())\n      .then(userInfo => {\n        let final = []\n        let sortedTransactions = {}\n        userInfo.data.attributes.transactions.forEach(transaction => {\n          if(sortedTransactions[transaction.stock_id]){\n            sortedTransactions[transaction.stock_id] += sortedTransactions[transaction.quantity]\n          } else {\n            sortedTransactions[transaction.stock_id] = transaction.quantity\n          }\n        })\n        console.log(sortedTransactions)\n        Object.keys(sortedTransactions).forEach(key => {\n          let stockToPush = {}\n          stockToPush.key = sortedTransactions[key]\n          debugger\n          final.push(stockToPush)\n        }) \n        debugger\n        setStocks([...stocks, sortedTransactions])\n      })\n    }\n  }, [props.userData])\n\n  const handleStockFormSubmit = (ticker, quantity) => {\n    fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=GJNL5RPAWAUNFOK6`)\n      .then(resp => resp.json())\n      .then(stockData => {\n        let userBalance = props.userData.attributes.balance\n        let price = parseFloat(stockData[\"Global Quote\"][\"05. price\"])\n        let transactionTotal = price * quantity\n        if (userBalance < transactionTotal) {\n          alert(`Balance insufficient. Transaction total is ${transactionTotal}.`)\n        } else {\n          handleStock(ticker, quantity, price, transactionTotal)\n        }\n      })\n      .catch(error => console.log(error))\n  }\n\n  const handleStock = (ticker, quantity, price, total) => {\n    let stockInfo = { ticker: ticker, price: price }\n    fetch('http://localhost:3000/stocks', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(stockInfo)\n    })\n      .then(resp => resp.json())\n      .then(stockData => {\n        handleTransaction(stockData.data, quantity, total)\n      })\n      .catch(error => console.log(error))\n  }\n\n  const handleTransaction = (stockData, quantity, total) => {\n    let transactionInfo = {\n      quantity: parseInt(quantity),\n      user_id: props.userData.id,\n      stock_id: parseInt(stockData.id)\n    }\n    fetch('http://localhost:3000/transactions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        Authorization: localStorage.token\n      },\n      body: JSON.stringify(transactionInfo)\n    })\n      .then(resp => resp.json())\n      .then(transactionData => {\n        console.log(total)\n        let balance = props.userData.attributes.balance\n        let remainingBalance = balance - total\n        props.handleBalanceChange(remainingBalance)\n        // setUserData(\n        //   {\n        //     ...userData,\n        //     attributes: {\n        //       ...userData.attributes,\n        //       balance: remainingBalance\n        //     }\n        //   }\n        // )\n      })\n      .catch(error => console.log(error))\n  }\n\n  // const handleBalanceChange = (remainingBalance) => {\n  //   fetch(`http://localhost:3000/users/${this.props.userData.id}`, {\n  //     method: 'PATCH',\n  //     headers: {\n  //       'Accept': 'application/json',\n  //       'Content-Type': 'application/json'\n  //     },\n  //     body: JSON.stringify({ balance: remainingBalance })\n  //   })\n  //     .then(resp => resp.json())\n  //     .then(userData => {\n  //       setUserData(userData.data)\n  //     })\n  // }\n  return (\n    <div className=\"portfolio\">\n      {/* {console.log(\"1\")}\n      <h2 className=\"page-header\">Portfolio</h2>\n      Hi, {userData ? userData.attributes.name : null}\n      <br /> */}\n      <PortfolioStock userData={props.userData} stocks={stocks}/>\n      {/* Balance: {userBalance ? userBalance : null} */}\n      <BuyStockForm {...props} handleStockFormSubmit={handleStockFormSubmit} />\n    </div>\n  )\n}\n\nexport default Portfolio"]},"metadata":{},"sourceType":"module"}